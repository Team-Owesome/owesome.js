!function(a){"use strict";var b={};a.ow=b;var c=function(a,b,c,d,e,f){this.a=void 0!=a?+a:1,this.b=void 0!=b?+b:0,this.c=void 0!=d?+d:0,this.d=void 0!=e?+e:1,this.tx=void 0!=c?+c:0,this.ty=void 0!=f?+f:0};c.prototype.toArray=function(){this.array;return[this.a,this.b,this.tx,this.c,this.d,this.ty,0,0,1]},c.prototype.toNativeArray=function(){return new Float32Array(this.toArray())},c.prototype.copy=function(){return new c(this.a,this.b,this.tx,this.c,this.d,this.ty)},c.prototype.translate=function(a,b){return this.multiplyBy(1,0,a,0,1,b)},c.prototype.translation=function(a,b){return this.copy().translate(a,b)},c.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a);return this.multiplyBy(b,-c,0,c,b,0)},c.prototype.scale=function(a,b){return this.multiplyBy(a,0,0,0,b,0)},c.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},c.prototype.multiplyBy=function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.tx,j=this.c,k=this.d,l=this.ty;return this.a=g*a+h*d,this.b=g*b+h*e,this.tx=g*c+h*f+i,this.c=j*a+k*d,this.d=j*b+k*e,this.ty=j*c+k*f+l,this},c.prototype.multiply=function(a){return this.multiplyBy(a.a,a.b,a.tx,a.c,a.d,a.ty)},c.prototype.multiplication=function(a){return this.copy().multiply(a)},c.Identity=function(){return new c},c.Translation=function(a,b){return new c(1,0,a,0,1,b)},c.Rotation=function(a){var b=Math.cos(a),d=Math.sin(a);return new c(b,-d,0,d,b,0)},c.Scale=function(a,b){return new c(a,0,0,0,b,0)},b.Matrix=c;var d=function(a,b){this.x=void 0!==a?+a:0,this.y=void 0!==b?+b:this.x};d.prototype.toArray=function(){return[this.x,this.y]},d.prototype.toNativeArray=function(){return new Float32Array(this.toArray())},d.prototype.copy=function(){return new d(this.x,this.y)},d.prototype.set=function(a,b){this.x=a,this.y=void 0!==b?b:a},d.prototype.add=function(a,b){return a instanceof d?(this.x+=a.x,this.y+=a.y):(this.x+=+a,this.y+=+(b||a)),this},d.prototype.addition=function(a,b){return this.clone().add(a,b)},d.prototype.substract=function(a,b){return a instanceof d?(this.x-=a.x,this.y-=a.y):(this.x-=+a,this.y-=+(b||a)),this},d.prototype.substraction=function(a,b){return this.clone().substract(a,b)},d.prototype.multiply=function(a,b){return a instanceof d?(this.x*=a.x,this.y*=a.y):(this.x*=+a,this.y*=+(b||a)),this},d.prototype.multiplication=function(a,b){return this.clone().multiplication(a,b)},d.prototype.applyMatrix=function(a){var b=this.x,c=this.y;this.x=a.a*b+a.b*c+a.tx,this.y=a.c*b+a.d*c+a.ty},b.Vector=d;var e=function(a,b,c,d){this.x=void 0!==a?+a:0,this.y=void 0!==b?+b:0,this.width=void 0!==c?+c:0,this.height=void 0!==d?+d:0};e.prototype.copy=function(){return new e(this.x,this.y,this.width,this.height)},b.Rectangle=e;var f=function(a,b,c){this._id=f.CurrentId++,this.width=0,this.height=0,"string"==typeof a?(this._internalImage=new Image,this._internalImage.src=a):a instanceof Image&&(this._internalImage=a),this.loaded=this._internalImage.complete;var d=this;this.loaded?this._checkPowerOfTwo():(this._internalImage.addEventListener("error",function(){c&&c()}),this._internalImage.addEventListener("load",function(){d._checkPowerOfTwo(),d.loaded=!0,b&&b()}))};f.prototype._checkPowerOfTwo=function(){var a=this._internalImage.width,b=this._internalImage.height;if(!this._isPowerOfTwo(a)||!this._isPowerOfTwo(b)){var c=document.createElement("canvas");c.width=this._nextHighestPowerOfTwo(a),c.height=this._nextHighestPowerOfTwo(b);var d=c.getContext("2d");d.drawImage(this._internalImage,0,0,a,b),this._internalImage=c,a=c.width,b=c.height}this.width=a,this.height=b},f.prototype._isPowerOfTwo=function(a){return 0==(a&a-1)},f.prototype._nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1},f.prototype.getId=function(){return this._id},f.prototype.getImage=function(){return this._internalImage},f.CurrentId=0,b.Texture=f;var g=function(){this.parent=null};g.prototype.draw=function(){},g.prototype.copy=function(){},b.Drawable=g;var h=function(){b.Drawable.call(this),this.children=[],this.matrix=new c};h.prototype=Object.create(b.Drawable.prototype),h.prototype.constructor=h,g.prototype.copy=h.prototype.copy=function(){},g.prototype.add=h.prototype.add=function(a){a.parent&&a.parent.remove(a),a.parent=this,this.children.push(a)},g.prototype.insert=h.prototype.insert=function(a,b){a.parent&&a.parent.remove(a),a.parent=this,this.children.splice(b,0,a)},g.prototype.remove=h.prototype.remove=function(a){var b=this.children.indexOf(a);-1!==b&&(a.parent=null,this.children.splice(b,1))},b.DrawableContainer=h;var i=function(a,c,e,f){b.DrawableContainer.call(this),this.position=a||new d,this.scale=c||new d(1),this.rotation=e||0,this.anchor=f||new d(.5),this.width=0,this.height=0;var g=this.rotation*(Math.PI/180);this._sr=Math.sin(g),this._cr=Math.cos(g),this._cachedRotation=this.rotation};i.prototype=Object.create(h.prototype),i.prototype.constructor=i,i.prototype.copy=function(){},i.prototype.draw=function(a){this.width=a.width,this.height=a.height,this.updateMatrix();for(var b=0;b<this.children.length;++b){var c=this.children[b];c.draw(a)}},i.prototype.updateMatrix=function(){var a=this.matrix,b=this.width*this.anchor.x,c=this.height*this.anchor.y;if(this._cachedRotation!=this.rotation){var d=this.rotation*(Math.PI/180);this._sr=Math.sin(d),this._cr=Math.cos(d),this._cachedRotation=this.rotation}var e=this._sr,f=this._cr,g=this.scale.x,h=this.scale.y,i=f*g,j=-e*h,k=e*g,l=f*h,m=this.position.x-i*b-c*j,n=this.position.y-l*c-b*k;a.a=i,a.b=j,a.tx=m+this.width*this.anchor.x,a.c=k,a.d=l,a.ty=n+this.height*this.anchor.y},b.Scene=i;var j=function(a,c,f,g,h,i,j,k){b.DrawableContainer.call(this),this.texture=a||null,this.position=f||new d,this.scale=h||new d(1),this.rotation=g||0,this.anchor=i||new d(.5),this.textureRect=c||new e,this.alpha=j||1,this.color=k||16777215;var l=this.rotation*(Math.PI/180);this._sr=Math.sin(l),this._cr=Math.cos(l),this._cachedRotation=this.rotation};j.prototype=Object.create(h.prototype),j.prototype.constructor=j,j.prototype.copy=function(){for(var a=new b.Sprite(this.texture,this.textureRect.copy(),this.position.copy(),this.rotation,this.scale.copy(),this.anchor.copy(),this.alpha,this.color),c=0;c<this.children.length;++c){var d=this.children[c],e=d.copy();a.add(e)}return a},j.prototype.draw=function(a){this.updateMatrix(),this.texture&&a.drawTexture(this.texture,this.textureRect,this.matrix,this.alpha,this.color);for(var b=0;b<this.children.length;++b){var c=this.children[b];c.draw(a)}},j.prototype.updateMatrix=function(){var a=this.parent,b=this.matrix,c=null,d=0,e=0;a?(c=a.matrix,a instanceof j?(d=-a.textureRect.width*a.anchor.x,e=-a.textureRect.height*a.anchor.y):a instanceof i&&(d=-a.width*a.anchor.x,e=-a.height*a.anchor.y)):c={a:1,b:0,tx:0,c:0,d:1,ty:0};var f=this.textureRect.width*this.anchor.x,g=this.textureRect.height*this.anchor.y;if(this._cachedRotation!=this.rotation){var h=this.rotation*(Math.PI/180);this._sr=Math.sin(h),this._cr=Math.cos(h),this._cachedRotation=this.rotation}var k=this._sr,l=this._cr,m=this.scale.x,n=this.scale.y,o=l*m,p=-k*n,q=k*m,r=l*n,s=this.position.x-o*f-g*p-d,t=this.position.y-r*g-f*q-e,u=c.a,v=c.b,w=c.c,x=c.d;b.a=u*o+v*q,b.b=u*p+v*r,b.tx=u*s+v*t+c.tx,b.c=w*o+x*q,b.d=w*p+x*r,b.ty=w*s+x*t+c.ty},b.Sprite=j;var k=function(){};k.prototype.render=function(){},k.prototype.clear=function(){},k.prototype.drawTexture=function(){},b.Renderer=k,b.SPRITE_FRAG_SHADER_SRC="uniform sampler2D uTexture;varying mediump vec2 vTexCoord;varying lowp vec4 vColor;void main(){ gl_FragColor = texture2D(uTexture, vTexCoord) * vColor;}",b.SPRITE_VERT_SHADER_SRC="uniform mediump mat4 uProjectionMatrix;attribute mediump vec2 aPosition;attribute mediump vec2 aTexCoord;attribute lowp vec2 aColor;varying mediump vec2 vTexCoord;varying lowp vec4 vColor;void main() { gl_Position = uProjectionMatrix * vec4(aPosition.xy, 0.0, 1.0); vTexCoord = aTexCoord; vec3 color = mod(vec3(aColor.y / 65536.0, aColor.y / 256.0, aColor.y), 256.0) / 256.0; vColor = vec4(color * aColor.x, aColor.x);}";var l=function(a){this._glTextures=[],this._context=a};l.prototype.getGlTexture=function(a){var b=this._glTextures[a.getId()];if(!b){if(!a.loaded)return 0;var c=this._context;b=c.createTexture(),c.bindTexture(c.TEXTURE_2D,b),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.getImage()),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.bindTexture(c.TEXTURE_2D,null),this._glTextures[a.getId()]=b}return b},b.TextureCache=l;var m=6*Float32Array.BYTES_PER_ELEMENT,n=2*Float32Array.BYTES_PER_ELEMENT,o=4*Float32Array.BYTES_PER_ELEMENT,p=2e3,q=500,r=500,s=[],t=function(){this.size=0,this.texture=null,this.vertexBufferArray=new Float32Array(24*p)};t.prototype.dispose=function(){this.size=0,this.texture=null,s.push(this)},t.create=function(){var a=s.pop();return a||(a=new t),a};var u=function(a,c){a=a||q,c=c||r,this.domElement=document.createElement("canvas");var d={preserveDrawingBuffer:!0},e=this.domElement.getContext("webgl",d)||this.domElement.getContext("experimental-webgl",d);e.clearColor(0,0,0,1),this.drawBatches=[],this.renderSession=[],this.textureCache=new b.TextureCache(e);var f=e.createShader(e.VERTEX_SHADER),g=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(f,b.SPRITE_VERT_SHADER_SRC),e.compileShader(f),e.shaderSource(g,b.SPRITE_FRAG_SHADER_SRC),e.compileShader(g);var h=e.createProgram();e.attachShader(h,f),e.attachShader(h,g),e.linkProgram(h),e.useProgram(h),e.deleteShader(f),e.deleteShader(g),this._positionLocation=e.getAttribLocation(h,"aPosition"),this._texCoordLocation=e.getAttribLocation(h,"aTexCoord"),this._colorLocation=e.getAttribLocation(h,"aColor"),this._matrixLocation=e.getUniformLocation(h,"uProjectionMatrix"),this._textureLocation=e.getUniformLocation(h,"uTexture"),this._indexBuffer=e.createBuffer(),this._vertexBuffer=e.createBuffer();for(var i=new Uint16Array(6*p),j=0;j<i.length;++j){var k=6*j,l=4*j;i[k+0]=l+0,i[k+1]=l+1,i[k+2]=l+2,i[k+3]=l+2,i[k+4]=l+3,i[k+5]=l+0}e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(24*p),e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),e.enableVertexAttribArray(this._positionLocation),e.vertexAttribPointer(this._positionLocation,2,e.FLOAT,!1,m,0),e.enableVertexAttribArray(this._texCoordLocation),e.vertexAttribPointer(this._texCoordLocation,2,e.FLOAT,!1,m,n),e.enableVertexAttribArray(this._colorLocation),e.vertexAttribPointer(this._colorLocation,2,e.FLOAT,!1,m,o),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),this.gl=e,this.setSize(a,c)};u.prototype=Object.create(k.prototype),u.prototype.constructor=u,u.prototype.drawTexture=function(a,b,c,d,e){var f=a.getId(),g=this.drawBatches,h=(g.length,g[f]);h||(h=t.create(),h.texture=a,g[f]=h);var i=h.vertexBufferArray,j=h.size,k=24*j,l=b.x,m=b.y,n=b.width,o=b.height,q=m/a.height,r=l/a.width,s=(l+n)/a.width,u=(m+o)/a.height;i[k+0]=c.tx,i[k+1]=c.ty,i[k+2]=r,i[k+3]=q,i[k+4]=d,i[k+5]=e,i[k+6]=c.a*n+c.tx,i[k+7]=c.c*n+c.ty,i[k+8]=s,i[k+9]=q,i[k+10]=d,i[k+11]=e,i[k+12]=c.a*n+c.b*o+c.tx,i[k+13]=c.c*n+c.d*o+c.ty,i[k+14]=s,i[k+15]=u,i[k+16]=d,i[k+17]=e,i[k+18]=c.b*o+c.tx,i[k+19]=c.d*o+c.ty,i[k+20]=r,i[k+21]=u,i[k+22]=d,i[k+23]=e,++h.size,h.size>=p&&(this._flushBatch(h),h.size=0)},u.prototype.render=function(a){a.draw(this);var b,c=(this.gl,this.drawBatches),d=(c.length,null);for(b in c)d=c[b],this._flushBatch(d),d.dispose();c.length=0},u.prototype._flushBatch=function(a){var b=this.gl,c=a.vertexBufferArray,d=a.texture,e=this.textureCache.getGlTexture(d);e&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,e),b.uniform1i(this._textureLocation,0)),b.bufferSubData(b.ARRAY_BUFFER,0,c.subarray(0,24*a.size)),b.drawElements(b.TRIANGLES,6*a.size,b.UNSIGNED_SHORT,0)},u.prototype.setSize=function(a,b){var c=this.gl;this.width=+a,this.height=+b,this.domElement.width=this.width,this.domElement.height=this.height,c.uniformMatrix4fv(this._matrixLocation,!1,[2/this.width,0,0,0,0,-2/this.height,0,0,0,0,0,0,-1,1,0,1]),c.viewport(0,0,this.width,this.height)},u.prototype.clear=function(){var a=this.gl;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)},b.WebGlRenderer=u}(this);