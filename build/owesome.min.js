!function(){"use strict";var a={};arguments[0].ow=a;var b=function(a,b,c,d,e,f){this.a=void 0!=a?+a:1,this.b=void 0!=b?+b:0,this.c=void 0!=d?+d:0,this.d=void 0!=e?+e:1,this.tx=void 0!=c?+c:0,this.ty=void 0!=f?+f:0};b.prototype.toArray=function(){this.array;return[this.a,this.b,this.tx,this.c,this.d,this.ty,0,0,1]},b.prototype.toNativeArray=function(){return new Float32Array(this.toArray())},b.prototype.copy=function(){return new b(this.a,this.b,this.tx,this.c,this.d,this.ty)},b.prototype.translate=function(a,b){return this.multiplyBy(1,0,a,0,1,b)},b.prototype.translation=function(a,b){return this.copy().translate(a,b)},b.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a);return this.multiplyBy(b,-c,0,c,b,0)},b.prototype.scale=function(a,b){return this.multiplyBy(a,0,0,0,b,0)},b.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},b.prototype.multiplyBy=function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.tx,j=this.c,k=this.d,l=this.ty;return this.a=g*a+h*d,this.b=g*b+h*e,this.tx=g*c+h*f+i,this.c=j*a+k*d,this.d=j*b+k*e,this.ty=j*c+k*f+l,this},b.prototype.multiply=function(a){return this.multiplyBy(a.a,a.b,a.tx,a.c,a.d,a.ty)},b.prototype.multiplication=function(a){return this.copy().multiply(a)},b.Identity=function(){return new b},b.Translation=function(a,c){return new b(1,0,a,0,1,c)},b.Rotation=function(a){var c=Math.cos(a),d=Math.sin(a);return new b(c,-d,0,d,c,0)},b.Scale=function(a,c){return new b(a,0,0,0,c,0)},a.Matrix=b;var c=function(a,b){this.x=void 0!==a?+a:0,this.y=void 0!==b?+b:this.x};c.prototype.toArray=function(){return[this.x,this.y]},c.prototype.toNativeArray=function(){return new Float32Array(this.toArray())},c.prototype.copy=function(){return new c(this.x,this.y)},c.prototype.set=function(a,b){this.x=a,this.y=void 0!==b?b:a},c.prototype.add=function(a,b){return a instanceof c?(this.x+=a.x,this.y+=a.y):(this.x+=+a,this.y+=+(b||a)),this},c.prototype.addition=function(a,b){return this.clone().add(a,b)},c.prototype.substract=function(a,b){return a instanceof c?(this.x-=a.x,this.y-=a.y):(this.x-=+a,this.y-=+(b||a)),this},c.prototype.substraction=function(a,b){return this.clone().substract(a,b)},c.prototype.multiply=function(a,b){return a instanceof c?(this.x*=a.x,this.y*=a.y):(this.x*=+a,this.y*=+(b||a)),this},c.prototype.multiplication=function(a,b){return this.clone().multiplication(a,b)},c.prototype.applyMatrix=function(a){var b=this.x,c=this.y;this.x=a.a*b+a.b*c+a.tx,this.y=a.c*b+a.d*c+a.ty},a.Vector=c;var d=function(a,b,c,d){this.x=void 0!==a?+a:0,this.y=void 0!==b?+b:0,this.width=void 0!==c?+c:0,this.height=void 0!==d?+d:0};d.prototype.copy=function(){return new d(this.x,this.y,this.width,this.height)},a.Rectangle=d;var e=function(a,b,c){this._id=e.CurrentId++,this.width=0,this.height=0,"string"==typeof a?(this._internalImage=new Image,this._internalImage.src=a):a instanceof Image&&(this._internalImage=a),this.loaded=this._internalImage.complete;var d=this;this.loaded?this._checkPowerOfTwo():(this._internalImage.addEventListener("error",function(){c&&c()}),this._internalImage.addEventListener("load",function(){d._checkPowerOfTwo(),d.loaded=!0,b&&b()}))};e.prototype._checkPowerOfTwo=function(){var a=this._internalImage.width,b=this._internalImage.height;if(!this._isPowerOfTwo(a)||!this._isPowerOfTwo(b)){var c=document.createElement("canvas");c.width=this._nextHighestPowerOfTwo(a),c.height=this._nextHighestPowerOfTwo(b);var d=c.getContext("2d");d.drawImage(this._internalImage,0,0,a,b),this._internalImage=c,a=c.width,b=c.height}this.width=a,this.height=b},e.prototype._isPowerOfTwo=function(a){return 0==(a&a-1)},e.prototype._nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1},e.prototype.getId=function(){return this._id},e.prototype.getImage=function(){return this._internalImage},e.CurrentId=0,a.Texture=e;var f=function(){this.parent=null};f.prototype.draw=function(){},f.prototype.copy=function(){},a.Drawable=f;var g=function(){a.Drawable.call(this),this.children=[],this.matrix=new b};g.prototype=Object.create(a.Drawable.prototype),g.prototype.constructor=g,f.prototype.copy=g.prototype.copy=function(){},f.prototype.add=g.prototype.add=function(a){a.parent&&a.parent.remove(a),a.parent=this,this.children.push(a)},f.prototype.insert=g.prototype.insert=function(a,b){a.parent&&a.parent.remove(a),a.parent=this,this.children.splice(b,0,a)},f.prototype.remove=g.prototype.remove=function(a){var b=this.children.indexOf(a);-1!==b&&(a.parent=null,this.children.splice(b,1))},a.DrawableContainer=g;var h=function(b,d,e,f){a.DrawableContainer.call(this),this.position=b||new c,this.scale=d||new c(1),this.rotation=e||0,this.anchor=f||new c(.5),this.width=0,this.height=0;var g=this.rotation*(Math.PI/180);this._sr=Math.sin(g),this._cr=Math.cos(g),this._cachedRotation=this.rotation};h.prototype=Object.create(g.prototype),h.prototype.constructor=h,h.prototype.copy=function(){},h.prototype.draw=function(a){this.width=a.width,this.height=a.height,this.updateMatrix();for(var b=0;b<this.children.length;++b){var c=this.children[b];c.draw(a)}},h.prototype.updateMatrix=function(){var a=this.matrix,b=this.width*this.anchor.x,c=this.height*this.anchor.y;if(this._cachedRotation!=this.rotation){var d=this.rotation*(Math.PI/180);this._sr=Math.sin(d),this._cr=Math.cos(d),this._cachedRotation=this.rotation}var e=this._sr,f=this._cr,g=this.scale.x,h=this.scale.y,i=f*g,j=-e*h,k=e*g,l=f*h,m=this.position.x-i*b-c*j,n=this.position.y-l*c-b*k;a.a=i,a.b=j,a.tx=m+this.width*this.anchor.x,a.c=k,a.d=l,a.ty=n+this.height*this.anchor.y},a.Scene=h;var i=function(b,e,f,g,h,i,j,k){a.DrawableContainer.call(this),this.texture=b||null,this.position=f||new c,this.scale=h||new c(1),this.rotation=g||0,this.anchor=i||new c(.5),this.textureRect=e||new d,this.alpha=j||1,this.color=k||16777215;var l=this.rotation*(Math.PI/180);this._sr=Math.sin(l),this._cr=Math.cos(l),this._cachedRotation=this.rotation};i.prototype=Object.create(g.prototype),i.prototype.constructor=i,i.prototype.copy=function(){for(var b=new a.Sprite(this.texture,this.textureRect.copy(),this.position.copy(),this.rotation,this.scale.copy(),this.anchor.copy(),this.alpha,this.color),c=0;c<this.children.length;++c){var d=this.children[c],e=d.copy();b.add(e)}return b},i.prototype.draw=function(a){this.updateMatrix(),this.texture&&a.drawTexture(this.texture,this.textureRect,this.matrix,this.alpha,this.color);for(var b=0;b<this.children.length;++b){var c=this.children[b];c.draw(a)}},i.prototype.updateMatrix=function(){var a=this.parent,b=this.matrix,c=null,d=0,e=0;a?(c=a.matrix,a instanceof i?(d=-a.textureRect.width*a.anchor.x,e=-a.textureRect.height*a.anchor.y):a instanceof h&&(d=-a.width*a.anchor.x,e=-a.height*a.anchor.y)):c={a:1,b:0,tx:0,c:0,d:1,ty:0};var f=this.textureRect.width*this.anchor.x,g=this.textureRect.height*this.anchor.y;if(this._cachedRotation!=this.rotation){var j=this.rotation*(Math.PI/180);this._sr=Math.sin(j),this._cr=Math.cos(j),this._cachedRotation=this.rotation}var k=this._sr,l=this._cr,m=this.scale.x,n=this.scale.y,o=l*m,p=-k*n,q=k*m,r=l*n,s=this.position.x-o*f-g*p-d,t=this.position.y-r*g-f*q-e,u=c.a,v=c.b,w=c.c,x=c.d;b.a=u*o+v*q,b.b=u*p+v*r,b.tx=u*s+v*t+c.tx,b.c=w*o+x*q,b.d=w*p+x*r,b.ty=w*s+x*t+c.ty},a.Sprite=i;var j=function(){};j.prototype.render=function(){},j.prototype.clear=function(){},j.prototype.drawTexture=function(){},a.Renderer=j,a.SPRITE_FRAG_SHADER_SRC="uniform sampler2D uTexture;varying mediump vec2 vTexCoord;varying lowp vec4 vColor;void main(){ gl_FragColor = texture2D(uTexture, vTexCoord) * vColor;}",a.SPRITE_VERT_SHADER_SRC="uniform mediump mat4 uProjectionMatrix;attribute mediump vec2 aPosition;attribute mediump vec2 aTexCoord;attribute lowp vec2 aColor;varying mediump vec2 vTexCoord;varying lowp vec4 vColor;void main() { gl_Position = uProjectionMatrix * vec4(aPosition.xy, 0.0, 1.0); vTexCoord = aTexCoord; vec3 color = mod(vec3(aColor.y / 65536.0, aColor.y / 256.0, aColor.y), 256.0) / 256.0; vColor = vec4(color * aColor.x, aColor.x);}";var k=function(a){this._glTextures=[],this._context=a};k.prototype.getGlTexture=function(a){var b=this._glTextures[a.getId()];if(!b){if(!a.loaded)return 0;var c=this._context;b=c.createTexture(),c.bindTexture(c.TEXTURE_2D,b),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.getImage()),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_NEAREST),c.generateMipmap(c.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null),this._glTextures[a.getId()]=b}return b},a.TextureCache=k;var l=6*Float32Array.BYTES_PER_ELEMENT,m=2*Float32Array.BYTES_PER_ELEMENT,n=4*Float32Array.BYTES_PER_ELEMENT,o=2e3,p=500,q=500,r=[],s=function(){this.size=0,this.texture=null,this.vertexBufferArray=new Float32Array(24*o)};s.prototype.dispose=function(){this.size=0,this.texture=null,r.push(this)},s.create=function(){var a=r.pop();return a||(a=new s),a};var t=function(b,c){b=b||p,c=c||q,this.domElement=document.createElement("canvas");var d={preserveDrawingBuffer:!0},e=this.domElement.getContext("webgl",d)||this.domElement.getContext("experimental-webgl",d);e.clearColor(0,0,0,1),this.drawBatches=[],this.renderSession=[],this.textureCache=new a.TextureCache(e);var f=e.createShader(e.VERTEX_SHADER),g=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(f,a.SPRITE_VERT_SHADER_SRC),e.compileShader(f),e.shaderSource(g,a.SPRITE_FRAG_SHADER_SRC),e.compileShader(g);var h=e.createProgram();e.attachShader(h,f),e.attachShader(h,g),e.linkProgram(h),e.useProgram(h),e.deleteShader(f),e.deleteShader(g),this._positionLocation=e.getAttribLocation(h,"aPosition"),this._texCoordLocation=e.getAttribLocation(h,"aTexCoord"),this._colorLocation=e.getAttribLocation(h,"aColor"),this._matrixLocation=e.getUniformLocation(h,"uProjectionMatrix"),this._textureLocation=e.getUniformLocation(h,"uTexture"),this._indexBuffer=e.createBuffer(),this._vertexBuffer=e.createBuffer();for(var i=new Uint16Array(6*o),j=0;j<i.length;++j){var k=6*j,r=4*j;i[k+0]=r+0,i[k+1]=r+1,i[k+2]=r+2,i[k+3]=r+2,i[k+4]=r+3,i[k+5]=r+0}e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(24*o),e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),e.enableVertexAttribArray(this._positionLocation),e.vertexAttribPointer(this._positionLocation,2,e.FLOAT,!1,l,0),e.enableVertexAttribArray(this._texCoordLocation),e.vertexAttribPointer(this._texCoordLocation,2,e.FLOAT,!1,l,m),e.enableVertexAttribArray(this._colorLocation),e.vertexAttribPointer(this._colorLocation,2,e.FLOAT,!1,l,n),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),this.gl=e,this.setSize(b,c)};t.prototype=Object.create(j.prototype),t.prototype.constructor=t,t.prototype.drawTexture=function(a,b,c,d,e){var f=a.getId(),g=this.drawBatches,h=(g.length,g[f]);h||(h=s.create(),h.texture=a,g[f]=h);var i=h.vertexBufferArray,j=h.size,k=24*j,l=b.x,m=b.y,n=b.width,p=b.height,q=m/a.height,r=l/a.width,t=(l+n)/a.width,u=(m+p)/a.height;i[k+0]=c.tx,i[k+1]=c.ty,i[k+2]=r,i[k+3]=q,i[k+4]=d,i[k+5]=e,i[k+6]=c.a*n+c.tx,i[k+7]=c.c*n+c.ty,i[k+8]=t,i[k+9]=q,i[k+10]=d,i[k+11]=e,i[k+12]=c.a*n+c.b*p+c.tx,i[k+13]=c.c*n+c.d*p+c.ty,i[k+14]=t,i[k+15]=u,i[k+16]=d,i[k+17]=e,i[k+18]=c.b*p+c.tx,i[k+19]=c.d*p+c.ty,i[k+20]=r,i[k+21]=u,i[k+22]=d,i[k+23]=e,++h.size,h.size>=o&&(this._flushBatch(h),h.size=0)},t.prototype.render=function(a){a.draw(this);var b,c=(this.gl,this.drawBatches),d=(c.length,null);for(b in c)d=c[b],this._flushBatch(d),d.dispose();c.length=0},t.prototype._flushBatch=function(a){var b=this.gl,c=a.vertexBufferArray,d=a.texture,e=this.textureCache.getGlTexture(d);e&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,e),b.uniform1i(this._textureLocation,0)),b.bufferSubData(b.ARRAY_BUFFER,0,c.subarray(0,24*a.size)),b.drawElements(b.TRIANGLES,6*a.size,b.UNSIGNED_SHORT,0)},t.prototype.setSize=function(a,b){var c=this.gl;this.width=+a,this.height=+b,this.domElement.width=this.width,this.domElement.height=this.height,c.uniformMatrix4fv(this._matrixLocation,!1,[2/this.width,0,0,0,0,-2/this.height,0,0,0,0,0,0,-1,1,0,1]),c.viewport(0,0,this.width,this.height)},t.prototype.clear=function(){var a=this.gl;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)},a.WebGlRenderer=t}(this);