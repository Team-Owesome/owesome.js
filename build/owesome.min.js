"use strict";var ow={};!function(){var a=function(a,b,c,d,e,f){this.a=void 0!=a?+a:1,this.b=void 0!=b?+b:0,this.c=void 0!=d?+d:0,this.d=void 0!=e?+e:1,this.tx=void 0!=c?+c:0,this.ty=void 0!=f?+f:0},b=a.prototype;b.toArray=function(){this.array;return[this.a,this.b,this.tx,this.c,this.d,this.ty,0,0,1]},b.toNativeArray=function(){return new Float32Array(this.toArray())},b.copy=function(){return new a(this.a,this.b,this.tx,this.c,this.d,this.ty)},b.translate=function(a,b){return this.multiplyBy(1,0,a,0,1,b)},b.translation=function(a,b){return this.copy().translate(a,b)},b.rotate=function(a){var b=Math.cos(a),c=Math.sin(a);return this.multiplyBy(b,-c,0,c,b,0)},b.scale=function(a,b){return this.multiplyBy(a,0,0,0,b,0)},b.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},b.multiplyBy=function(a,b,c,d,e,f){var g=this.a,h=this.b,i=this.tx,j=this.c,k=this.d,l=this.ty;return this.a=g*a+h*d,this.b=g*b+h*e,this.tx=g*c+h*f+i,this.c=j*a+k*d,this.d=j*b+k*e,this.ty=j*c+k*f+l,this},b.multiply=function(a){return this.multiplyBy(a.a,a.b,a.tx,a.c,a.d,a.ty)},b.multiplication=function(a){return this.copy().multiply(a)},a.Identity=function(){return new a},a.Translation=function(b,c){return new a(1,0,b,0,1,c)},a.Rotation=function(b){var c=Math.cos(b),d=Math.sin(b);return new a(c,-d,0,d,c,0)},a.Scale=function(b,c){return new a(b,0,0,0,c,0)},ow.Matrix=a}(),function(){var a=function(a,b){this.x=void 0!==a?+a:0,this.y=void 0!==b?+b:this.x},b=a.prototype;b.toArray=function(){return[this.x,this.y]},b.toNativeArray=function(){return new Float32Array(this.toArray())},b.copy=function(){return new a(this.x,this.y)},b.set=function(a,b){this.x=a,this.y=void 0!==b?b:a},b.add=function(b,c){return b instanceof a?(this.x+=b.x,this.y+=b.y):(this.x+=+b,this.y+=+(c||b)),this},b.addition=function(a,b){return this.clone().add(a,b)},b.substract=function(b,c){return b instanceof a?(this.x-=b.x,this.y-=b.y):(this.x-=+b,this.y-=+(c||b)),this},b.substraction=function(a,b){return this.clone().substract(a,b)},b.multiply=function(b,c){return b instanceof a?(this.x*=b.x,this.y*=b.y):(this.x*=+b,this.y*=+(c||b)),this},b.multiplication=function(a,b){return this.clone().multiplication(a,b)},b.applyMatrix=function(a){var b=this.x,c=this.y;this.x=a.a*b+a.b*c+a.tx,this.y=a.c*b+a.d*c+a.ty},ow.Vector=a}(),function(){var a=function(a,b,c,d){this.x=void 0!==a?+a:0,this.y=void 0!==b?+b:0,this.width=void 0!==c?+c:0,this.height=void 0!==d?+d:0},b=a.prototype;b.copy=function(){return new a(this.x,this.y,this.width,this.height)},ow.Rectangle=a}(),function(){var a=function(b,c,d){if(this._id=a.CurrentId++,this.width=0,this.height=0,"string"==typeof b)this._internalImage=new Image,this._internalImage.src=b;else{if(!(b instanceof Image))throw new TypeError("Expected Image or String!");this._internalImage=b}this.loaded=this._internalImage.complete;var e=this;this.loaded?this._checkPowerOfTwo():(this._internalImage.addEventListener("error",function(){d&&d()}),this._internalImage.addEventListener("load",function(){e._checkPowerOfTwo(),e.loaded=!0,c&&c()}))},b=a.prototype;b._checkPowerOfTwo=function(){var a=this._internalImage.width,b=this._internalImage.height;if(!this._isPowerOfTwo(a)||!this._isPowerOfTwo(b)){var c=document.createElement("canvas");c.width=this._nextHighestPowerOfTwo(a),c.height=this._nextHighestPowerOfTwo(b);var d=c.getContext("2d");d.drawImage(this._internalImage,0,0,a,b),this._internalImage=c,a=c.width,b=c.height}this.width=a,this.height=b},b._isPowerOfTwo=function(a){return 0==(a&a-1)},b._nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1},b.getId=function(){return this._id},b.getImage=function(){return this._internalImage},a.CurrentId=0,ow.Texture=a}(),function(){var a=function(){this.parent=null},b=a.prototype;b.draw=function(){},b.copy=function(){},ow.Drawable=a}(),function(){var a=function(){ow.Drawable.call(this),this.children=[],this.matrix=new ow.Matrix},b=a.prototype=Object.create(ow.Drawable.prototype);b.constructor=a,b.copy=function(){},b.add=function(a){a.parent&&a.parent.remove(a),a.parent=this,this.children.push(a)},b.insert=function(a,b){a.parent&&a.parent.remove(a),a.parent=this,this.children.splice(b,0,a)},b.remove=function(a){var b=this.children.indexOf(a);-1!==b&&(a.parent=null,this.children.splice(b,1))},ow.DrawableContainer=a}(),function(){var a=function(a,b,c,d){ow.DrawableContainer.call(this),this.position=a||new ow.Vector,this.scale=b||new ow.Vector(1),this.rotation=c||0,this.anchor=d||new ow.Vector(.5),this.width=0,this.height=0;var e=this.rotation*(Math.PI/180);this._sr=Math.sin(e),this._cr=Math.cos(e),this._cachedRotation=this.rotation},b=a.prototype=Object.create(ow.DrawableContainer.prototype);b.constructor=a,b.copy=function(){},b.draw=function(a){this.width=a.width,this.height=a.height,this.updateMatrix();for(var b=0;b<this.children.length;++b){var c=this.children[b];c.draw(a)}},b.updateMatrix=function(){var a=this.matrix,b=this.width*this.anchor.x,c=this.height*this.anchor.y;if(this._cachedRotation!=this.rotation){var d=this.rotation*(Math.PI/180);this._sr=Math.sin(d),this._cr=Math.cos(d),this._cachedRotation=this.rotation}var e=this._sr,f=this._cr,g=this.scale.x,h=this.scale.y,i=f*g,j=-e*h,k=e*g,l=f*h,m=this.position.x-i*b-c*j,n=this.position.y-l*c-b*k;a.a=i,a.b=j,a.tx=m+this.width*this.anchor.x,a.c=k,a.d=l,a.ty=n+this.height*this.anchor.y},ow.Scene=a}(),function(){var a=function(a,b,c,d,e,f,g,h){ow.DrawableContainer.call(this),this.texture=a||null,this.position=c||new ow.Vector,this.scale=e||new ow.Vector(1),this.rotation=d||0,this.anchor=f||new ow.Vector(.5),this.textureRect=b||new ow.Rectangle,this.alpha=g||1,this.color=h||16777215;var i=this.rotation*(Math.PI/180);this._sr=Math.sin(i),this._cr=Math.cos(i),this._cachedRotation=this.rotation},b=a.prototype=Object.create(ow.DrawableContainer.prototype);b.constructor=a,b.copy=function(){for(var a=new ow.Sprite(this.texture,this.textureRect.copy(),this.position.copy(),this.rotation,this.scale.copy(),this.anchor.copy(),this.alpha,this.color),b=0;b<this.children.length;++b){var c=this.children[b],d=c.copy();a.add(d)}return a},b.draw=function(a){this.updateMatrix(),this.texture&&a.drawTexture(this.texture,this.textureRect,this.matrix,this.alpha,this.color);for(var b=0;b<this.children.length;++b){var c=this.children[b];c.draw(a)}},b.updateMatrix=function(){var a=this.parent,b=this.matrix,c=null,d=0,e=0;a?(c=a.matrix,a instanceof ow.Sprite?(d=-a.textureRect.width*a.anchor.x,e=-a.textureRect.height*a.anchor.y):a instanceof ow.Scene&&(d=-a.width*a.anchor.x,e=-a.height*a.anchor.y)):c={a:1,b:0,tx:0,c:0,d:1,ty:0};var f=this.textureRect.width*this.anchor.x,g=this.textureRect.height*this.anchor.y;if(this._cachedRotation!=this.rotation){var h=this.rotation*(Math.PI/180);this._sr=Math.sin(h),this._cr=Math.cos(h),this._cachedRotation=this.rotation}var i=this._sr,j=this._cr,k=this.scale.x,l=this.scale.y,m=j*k,n=-i*l,o=i*k,p=j*l,q=this.position.x-m*f-g*n-d,r=this.position.y-p*g-f*o-e,s=c.a,t=c.b,u=c.c,v=c.d;b.a=s*m+t*o,b.b=s*n+t*p,b.tx=s*q+t*r+c.tx,b.c=u*m+v*o,b.d=u*n+v*p,b.ty=u*q+v*r+c.ty},ow.Sprite=a}(),function(){var a=function(){},b=a.prototype;b.render=function(){},b.clear=function(){},b.drawTexture=function(){},ow.Renderer=a}(),ow.SPRITE_FRAG_SHADER_SRC="uniform sampler2D uTexture;varying mediump vec2 vTexCoord;varying lowp vec4 vColor;void main(){ gl_FragColor = texture2D(uTexture, vTexCoord) * vColor;}",ow.SPRITE_VERT_SHADER_SRC="uniform mediump mat4 uProjectionMatrix;attribute mediump vec2 aPosition;attribute mediump vec2 aTexCoord;attribute lowp vec2 aColor;varying mediump vec2 vTexCoord;varying lowp vec4 vColor;void main() { gl_Position = uProjectionMatrix * vec4(aPosition.xy, 0.0, 1.0); vTexCoord = aTexCoord; vec3 color = mod(vec3(aColor.y / 65536.0, aColor.y / 256.0, aColor.y), 256.0) / 256.0; vColor = vec4(color * aColor.x, aColor.x);}",function(){var a=function(a){this._glTextures=[],this._context=a},b=a.prototype;b.getGlTexture=function(a){var b=this._glTextures[a.getId()];if(!b){if(!a.loaded)return 0;var c=this._context;b=c.createTexture(),c.bindTexture(c.TEXTURE_2D,b),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.getImage()),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_NEAREST),c.generateMipmap(c.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null),this._glTextures[a.getId()]=b}return b},ow.TextureCache=a}(),function(){var a=6*Float32Array.BYTES_PER_ELEMENT,b=2*Float32Array.BYTES_PER_ELEMENT,c=4*Float32Array.BYTES_PER_ELEMENT,d=2e3,e=500,f=500,g=[],h=function(){this.size=0,this.texture=null,this.vertexBufferArray=new Float32Array(24*d)},i=h.prototype;i.dispose=function(){this.size=0,this.texture=null,g.push(this)},h.create=function(){var a=g.pop();return a||(a=new h),a};var j=function(g,h){g=g||e,h=h||f,this.domElement=document.createElement("canvas");var i={preserveDrawingBuffer:!0},j=this.domElement.getContext("webgl",i)||this.domElement.getContext("experimental-webgl",i);j.clearColor(0,0,0,1),this.drawBatches=[],this.renderSession=[],this.textureCache=new ow.TextureCache(j);var k=j.createShader(j.VERTEX_SHADER),l=j.createShader(j.FRAGMENT_SHADER);j.shaderSource(k,ow.SPRITE_VERT_SHADER_SRC),j.compileShader(k),j.shaderSource(l,ow.SPRITE_FRAG_SHADER_SRC),j.compileShader(l);var m=j.createProgram();j.attachShader(m,k),j.attachShader(m,l),j.linkProgram(m),j.useProgram(m),j.deleteShader(k),j.deleteShader(l),this._positionLocation=j.getAttribLocation(m,"aPosition"),this._texCoordLocation=j.getAttribLocation(m,"aTexCoord"),this._colorLocation=j.getAttribLocation(m,"aColor"),this._matrixLocation=j.getUniformLocation(m,"uProjectionMatrix"),this._textureLocation=j.getUniformLocation(m,"uTexture"),this._indexBuffer=j.createBuffer(),this._vertexBuffer=j.createBuffer();for(var n=new Uint16Array(6*d),o=0;o<n.length;++o){var p=6*o,q=4*o;n[p+0]=q+0,n[p+1]=q+1,n[p+2]=q+2,n[p+3]=q+2,n[p+4]=q+3,n[p+5]=q+0}j.bindBuffer(j.ARRAY_BUFFER,this._vertexBuffer),j.bufferData(j.ARRAY_BUFFER,new Float32Array(24*d),j.DYNAMIC_DRAW),j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,this._indexBuffer),j.bufferData(j.ELEMENT_ARRAY_BUFFER,n,j.STATIC_DRAW),j.enableVertexAttribArray(this._positionLocation),j.vertexAttribPointer(this._positionLocation,2,j.FLOAT,!1,a,0),j.enableVertexAttribArray(this._texCoordLocation),j.vertexAttribPointer(this._texCoordLocation,2,j.FLOAT,!1,a,b),j.enableVertexAttribArray(this._colorLocation),j.vertexAttribPointer(this._colorLocation,2,j.FLOAT,!1,a,c),j.blendFunc(j.SRC_ALPHA,j.ONE_MINUS_SRC_ALPHA),j.enable(j.BLEND),this.gl=j,this.setSize(g,h)};i=j.prototype=Object.create(ow.Renderer.prototype),i.constructor=j,i.drawTexture=function(a,b,c,e,f){var g=a.getId(),i=this.drawBatches,j=(i.length,i[g]);j||(j=h.create(),j.texture=a,i[g]=j);var k=j.vertexBufferArray,l=j.size,m=24*l,n=b.x,o=b.y,p=b.width,q=b.height,r=o/a.height,s=n/a.width,t=(n+p)/a.width,u=(o+q)/a.height;k[m+0]=c.tx,k[m+1]=c.ty,k[m+2]=s,k[m+3]=r,k[m+4]=e,k[m+5]=f,k[m+6]=c.a*p+c.tx,k[m+7]=c.c*p+c.ty,k[m+8]=t,k[m+9]=r,k[m+10]=e,k[m+11]=f,k[m+12]=c.a*p+c.b*q+c.tx,k[m+13]=c.c*p+c.d*q+c.ty,k[m+14]=t,k[m+15]=u,k[m+16]=e,k[m+17]=f,k[m+18]=c.b*q+c.tx,k[m+19]=c.d*q+c.ty,k[m+20]=s,k[m+21]=u,k[m+22]=e,k[m+23]=f,++j.size,j.size>=d&&(this._flushBatch(j),j.size=0)},i.render=function(a){a.draw(this);var b,c=(this.gl,this.drawBatches),d=(c.length,null);for(b in c)d=c[b],this._flushBatch(d),d.dispose();c.length=0},i._flushBatch=function(a){var b=this.gl,c=a.vertexBufferArray,d=a.texture,e=this.textureCache.getGlTexture(d);e&&(b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,e),b.uniform1i(this._textureLocation,0)),b.bufferSubData(b.ARRAY_BUFFER,0,c.subarray(0,24*a.size)),b.drawElements(b.TRIANGLES,6*a.size,b.UNSIGNED_SHORT,0)},i.setSize=function(a,b){var c=this.gl;this.width=+a,this.height=+b,this.domElement.width=this.width,this.domElement.height=this.height,c.uniformMatrix4fv(this._matrixLocation,!1,[2/this.width,0,0,0,0,-2/this.height,0,0,0,0,0,0,-1,1,0,1]),c.viewport(0,0,this.width,this.height)},i.clear=function(){var a=this.gl;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)},ow.WebGlRenderer=j}();